<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>GIF Sender - ChaosTitan41</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .box { background: #1e1e1e; padding: 25px; border-radius: 15px; display: inline-block; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        input { padding: 12px; width: 300px; border-radius: 5px; border: 1px solid #444; background: #222; color: white; margin-bottom: 10px; }
        button { padding: 12px 20px; background: #a970ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 15px; font-weight: bold; }
        .preview { margin-top: 15px; max-width: 150px; border-radius: 8px; display: none; margin-left: auto; margin-right: auto; }
    </style>
</head>
<body>
    <div class="box">
        <h2>GIF an Stream senden</h2>
        <input type="text" id="username" placeholder="Dein Name"><br>
        <input type="text" id="gif-url" placeholder="Giphy Link einfügen..." oninput="updatePreview()"><br>
        <img id="gif-preview" class="preview" src=""><br>
        <button onclick="send()">Senden</button>
        <div id="status"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC4fo69Q0sf7DVgJSDhojAPzLsQ7SDu6cg",
            authDomain: "chaostitan41-website.firebaseapp.com",
            databaseURL: "https://chaostitan41-website-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chaostitan41-website",
            storageBucket: "chaostitan41-website.firebasestorage.app",
            messagingSenderId: "553158677453",
            appId: "1:553158677453:web:2cad39890ffdedb98aaa84"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function getID(url) {
            try {
                const parts = url.split("/");
                // Filtert die ID aus media-Links oder normalen Links
                let id = url.includes("/gifs/") ? url.split("-").pop().split("/")[0] : parts[parts.length - 2];
                if (id.includes("?")) id = id.split("?")[0];
                return id;
            } catch(e) { return null; }
        }

        function updatePreview() {
            const id = getID(document.getElementById('gif-url').value);
            const img = document.getElementById('gif-preview');
            if(id) {
                img.src = `https://media.giphy.com/media/${id}/giphy.gif`;
                img.style.display = "block";
            } else { img.style.display = "none"; }
        }

        function send() {
            const id = getID(document.getElementById('gif-url').value);
            const name = document.getElementById('username').value || "Anonym";
            if(!id) return alert("Ungültiger Link!");

            db.ref('activeGifs').push({
                gifId: id,
                userName: name,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById('status').innerText = "✅ Gesendet!";
                document.getElementById('gif-url').value = "";
                document.getElementById('gif-preview').style.display = "none";
            });
        }
    </script>
</body>
</html>
