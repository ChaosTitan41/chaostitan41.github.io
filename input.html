<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIF Sender - ChaosTitan41</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background: #121212; color: white; text-align: center; padding: 20px; }
        .container { background: #1e1e1e; padding: 30px; border-radius: 15px; display: inline-block; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 90%; }
        h2 { color: #a970ff; margin-bottom: 20px; }
        input { padding: 12px; width: 280px; border-radius: 5px; border: 1px solid #333; background: #121212; color: white; margin-bottom: 15px; outline: none; }
        button { padding: 12px 25px; background: #a970ff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        #status { margin-top: 20px; font-weight: bold; }
        .preview-media { max-width: 200px; border-radius: 10px; border: 2px solid #a970ff; display: none; margin: 20px auto; }
    </style>
</head>
<body>

    <div class="container">
        <h2>GIF & Clip Sender</h2>
        <input type="text" id="username" placeholder="Dein Name"> <br>
        <input type="text" id="gif-url" placeholder="Giphy-Link hier einfügen..." oninput="showPreview()"> <br>
        
        <video id="video-preview" class="preview-media" autoplay loop muted playsinline></video>
        <img id="gif-preview" class="preview-media">
        
        <br>
        <button onclick="sendGif()">Ab an den Stream!</button>
        <div id="status"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC4fo69Q0sf7DVgJSDhojAPzLsQ7SDu6cg",
            authDomain: "chaostitan41-website.firebaseapp.com",
            databaseURL: "https://chaostitan41-website-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chaostitan41-website",
            storageBucket: "chaostitan41-website.firebasestorage.app",
            messagingSenderId: "553158677453",
            appId: "1:553158677453:web:2cad39890ffdedb98aaa84"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function extractGifId(url) {
            url = url.trim();
            if (!url.includes("giphy.com")) return null;
            try {
                const parts = url.split("/");
                let id = "";
                if (url.includes("/gifs/")) {
                    // ID aus Standard-Link
                    id = url.split("-").pop().split("/")[0].split("?")[0];
                } else {
                    // ID aus Media-Link
                    id = parts[parts.length - 2];
                }
                return id && id.length > 3 ? id : parts[parts.length - 1].split(".")[0];
            } catch (e) { return null; }
        }

        function showPreview() {
            const url = document.getElementById('gif-url').value;
            const vid = document.getElementById('video-preview');
            const img = document.getElementById('gif-preview');
            const id = extractGifId(url);

            if (id) {
                // Wir versuchen das Video (.mp4) zu laden, weil es perfekt loopt
                vid.src = `https://media.giphy.com/media/${id}/giphy.mp4`;
                vid.style.display = "block";
                img.style.display = "none";

                // Falls kein Video da ist, nehmen wir das GIF als Backup
                vid.onerror = () => {
                    vid.style.display = "none";
                    img.src = `https://media.giphy.com/media/${id}/giphy.gif`;
                    img.style.display = "block";
                };
            } else {
                vid.style.display = "none";
                img.style.display = "none";
            }
        }

        function sendGif() {
            const name = document.getElementById('username').value || "Anonym";
            const urlInput = document.getElementById('gif-url').value;
            const id = extractGifId(urlInput);

            if (!id) {
                document.getElementById('status').innerText = "❌ Link nicht erkannt!";
                return;
            }

            db.ref('activeGifs').push({
                gifId: id,
                userName: name,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            }).then(() => {
                document.getElementById('status').innerText = "✅ Gesendet!";
                document.getElementById('gif-url').value = "";
                document.getElementById('video-preview').style.display = "none";
                document.getElementById('gif-preview').style.display = "none";
            });
        }
    </script>
</body>
</html>
