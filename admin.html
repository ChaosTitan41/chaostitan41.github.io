<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // Deine Firebase Config im Compat-Format
        const firebaseConfig = {
            apiKey: "AIzaSyC4fo69Q0sf7DVgJSDhojAPzLsQ7SDu6cg",
            authDomain: "chaostitan41-website.firebaseapp.com",
            databaseURL: "https://chaostitan41-website-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chaostitan41-website",
            storageBucket: "chaostitan41-website.firebasestorage.app",
            messagingSenderId: "553158677453",
            appId: "1:553158677453:web:2cad39890ffdedb98aaa84",
            measurementId: "G-H9KMM44JZB"
        };

        // Initialisierung (verhindert doppelte Initialisierung)
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();

        // DEIN PASSWORT HIER EINTRAGEN
        const MASTER = "DEIN_PASSWORT"; 

        // Prüfen ob bereits eingeloggt
        window.onload = () => { 
            if(sessionStorage.getItem("lg") === "1") show(); 
        };

        function checkLogin() {
            const passInput = document.getElementById('admin-pass').value;
            if(passInput === MASTER) {
                sessionStorage.setItem("lg", "1");
                show();
            } else { 
                alert("Hatalı Şifre!"); 
            }
        }

        function show() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('admin-content').style.display = 'block';

            // --- BESUCHER STATISTIK LOGIK ---
            db.ref('stats/daily').on('value', snap => {
                const d = snap.val() || {}; 
                const now = new Date(); 
                const todayStr = now.toISOString().split('T')[0];
                
                let t = 0; 
                const w = new Set(), m = new Set(), y = new Set();
                
                Object.keys(d).forEach(dt => {
                    const date = new Date(dt); 
                    const ips = Object.keys(d[dt]);
                    
                    // Heute
                    if(dt === todayStr) t = ips.length;
                    
                    // Woche (letzte 7 Tage)
                    if((now - date) / 864e5 <= 7) ips.forEach(i => w.add(i));
                    
                    // Monat (aktueller Kalendermonat)
                    if(date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear()) {
                        ips.forEach(i => m.add(i));
                    }
                    
                    // Jahr
                    if(date.getFullYear() === now.getFullYear()) {
                        ips.forEach(i => y.add(i));
                    }
                });
                
                document.getElementById('s-today').innerText = t; 
                document.getElementById('s-week').innerText = w.size;
                document.getElementById('s-month').innerText = m.size; 
                document.getElementById('s-year').innerText = y.size;
            });

            // --- LIVE LOGS (GIFS) ---
            db.ref('activeGifs').limitToLast(10).on('value', s => {
                const b = document.getElementById('l-body'); 
                b.innerHTML = "";
                s.forEach(c => { 
                    const d = c.val(); 
                    b.insertAdjacentHTML('afterbegin', `
                        <tr>
                            <td>${new Date(d.timestamp).toLocaleTimeString()}</td>
                            <td>${d.userName}</td>
                            <td style="color:#00ff99; font-family:monospace;">${d.userIP.replace(/_/g,'.')}</td>
                            <td><button class="ban-btn" onclick="bn('${d.userIP}')">BAN</button></td>
                        </tr>`); 
                });
            });

            // --- BLOCKIERTE VERSUCHE (BANLI) ---
            db.ref('bannedRequests').limitToLast(10).on('value', s => {
                const b = document.getElementById('blocked-body'); 
                b.innerHTML = "";
                s.forEach(c => { 
                    const d = c.val(); 
                    b.insertAdjacentHTML('afterbegin', `
                        <tr style="color:#ffaa00; background:rgba(255,170,0,0.05);">
                            <td>${new Date(d.timestamp).toLocaleTimeString()}</td>
                            <td>${d.userName}</td>
                            <td>${d.userIP.replace(/_/g,'.')}</td>
                            <td><button class="unban-btn" onclick="ubn('${d.userIP}')">AFFET</button></td>
                        </tr>`); 
                });
            });

            // --- AKTIVE BAN LISTE ---
            db.ref('bannedIPs').on('value', s => {
                const b = document.getElementById('b-body'); 
                b.innerHTML = "";
                s.forEach(c => { 
                    b.innerHTML += `
                        <tr>
                            <td style="color:#00ff99; font-family:monospace;">${c.key.replace(/_/g,'.')}</td>
                            <td><button class="unban-btn" onclick="ubn('${c.key}')">KALDIR</button></td>
                        </tr>`; 
                });
            });
        }

        // Hilfsfunktionen für Ban/Unban
        function bn(i) { if(confirm("Bu IP adresi banlansın mı?")) db.ref('bannedIPs/' + i).set(true); }
        function ubn(i) { if(confirm("Ban kaldırılsın mı?")) db.ref('bannedIPs/' + i).remove(); }
    </script>
</body>
</html>
